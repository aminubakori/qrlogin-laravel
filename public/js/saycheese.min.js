var SayCheese=(function(){var i;navigator.getUserMedia=(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||false);window.AudioContext=(window.AudioContext||window.webkitAudioContext);window.URL=(window.URL||window.webkitURL);i=function i(m,l){this.snapshots=[],this.video=null,this.events={},this.stream=null,this.options={snapshots:true,audio:false};this.setOptions(l);this.element=document.querySelector(m);return this};i.prototype.on=function e(l,m){if(this.events.hasOwnProperty(l)===false){this.events[l]=[]}this.events[l].push(m)};i.prototype.off=function b(l,m){this.events=this.events[l].filter(function(n){if(n!==m){return n}})};i.prototype.trigger=function c(l,m){if(this.events.hasOwnProperty(l)===false){return false}this.events[l].forEach(function(n){n.call(this,m)}.bind(this))};i.prototype.setOptions=function g(l){for(var m in l){this.options[m]=l[m]}};i.prototype.getStreamUrl=function d(){if(window.URL&&window.URL.createObjectURL){return window.URL.createObjectURL(this.stream)}else{return this.stream}};i.prototype.createVideo=function k(){var m=320,l=0,n=false;this.video=document.createElement("video");this.video.addEventListener("canplay",function(){if(!n){l=this.video.videoHeight/(this.video.videoWidth/m);this.video.style.width=m;this.video.style.height=l;n=true;return this.trigger("start")}}.bind(this),false)};i.prototype.linkAudio=function f(){this.audioCtx=new window.AudioContext();this.audioStream=this.audioCtx.createMediaStreamSource(this.stream);var l=this.audioCtx.createBiquadFilter();this.audioStream.connect(l);l.connect(this.audioCtx.destination)};i.prototype.takeSnapshot=function j(o,l){if(this.options.snapshots===false){return false}o=o||this.video.videoWidth;l=l||this.video.videoHeight;var n=document.createElement("canvas"),m=n.getContext("2d");n.width=o;n.height=l;m.drawImage(this.video,0,0,o,l);this.snapshots.push(n);this.trigger("snapshot",n);m=null};i.prototype.start=function a(){if(navigator.getUserMedia===false){this.trigger("error","NOT_SUPPORTED");return false}var m=function m(o){this.stream=o;this.createVideo();if(navigator.mozGetUserMedia){this.video.mozSrcObject=o}else{this.video.src=this.getStreamUrl()}if(this.options.audio===true){try{this.linkAudio()}catch(n){this.trigger("error","AUDIO_NOT_SUPPORTED")}}this.element.appendChild(this.video);this.video.play()}.bind(this);var l=function l(n){this.trigger("error",n)}.bind(this);return navigator.getUserMedia({video:true,audio:this.options.audio},m,l)};i.prototype.stop=function h(){this.stream.stop();if(window.URL&&window.URL.revokeObjectURL){window.URL.revokeObjectURL(this.video.src)}return this.trigger("stop")};return i})();